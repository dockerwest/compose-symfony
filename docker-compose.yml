version: '3'

services:
  redis:
    image: redis:alpine
    environment:
      - DOMAIN_NAME=redis.${BASEHOST:-application.test}

  mysql:
    image: mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD:-toor}
      - DOMAIN_NAME=mysql.${BASEHOST:-application.test}
    command: --innodb-doublewrite=0

  mailcatcher:
    image: schickling/mailcatcher
    environment:
      - DOMAIN_NAME=mailcatcher.${BASEHOST:-application.test}

  application:
    image: dockerwest/php-symfony:${PHPVERSION:-7.1}
    environment:
      - C_UID=${C_UID:-1000}
      - C_GID=${G_UID:-1000}
      - DEVELOPMENT=${DEVELOPMENT:-noprofile}
    volumes:
      - ${APPLICATION:-../application}:/phpapp
    links:
      - mysql
      - redis
      - mailcatcher

  nginx:
    image: dockerwest/nginx-symfony${SYMFONYVERSION:-4}:${NGINXVERSION:-stable}
    environment:
      - VIRTUAL_HOST=${BASEHOST:-application.test},${EXTRAHOSTS}
    volumes:
      - ${APPLICATION:-../application}:/phpapp
    links:
      - application

